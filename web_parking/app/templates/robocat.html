{% extends "base.html" %}
{% block title %}Robocat - {{ robot_id }}{% endblock %}

{% block content %}
<div class="section" style="z-index: 2; position: relative; padding-top: 0px !important;">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-12 col-md-10 col-lg-8">
        <div class="card card-pricing" data-color="white">
          <div class="card-body text-center">

            <h2>Robocat: {{ robot_id }}</h2>

            <!-- VÃ­deo en directe -->
            <div class="my-3">
              <img id="video" src="/video/{{ robot_id }}" class="img-fluid rounded border" />
            </div>

            <!-- Telemetria -->
            <h4 class="mt-4">ðŸ“Š Telemetria</h4>
            <pre id="telemetria" class="text-left bg-light p-2 rounded" style="min-height: 150px;">Esperant dades...</pre>

            <!-- Controls -->
            <h4 class="mt-4">ðŸŽ® Controls</h4>
            <div class="d-grid gap-2 d-md-block">
              <button onclick="enviar('endavant')" class="btn btn-success m-1">Endavant</button>
              <button onclick="enviar('enrere')" class="btn btn-secondary m-1">Enrere</button>
              <button onclick="enviar('esquerra')" class="btn btn-primary m-1">Esquerra</button>
              <button onclick="enviar('dreta')" class="btn btn-primary m-1">Dreta</button>
              <button onclick="enviar('atura')" class="btn btn-danger m-1">Atura</button>
            </div>

            <!-- Controls -->
            <h4 class="mt-4">ðŸŽ® Controls 2</h4>
            <div class="d-grid gap-2 d-md-block">
              <button onclick="enviar('ajupir')" class="btn btn-success m-1">Ajupir</button>
              <button onclick="enviar('normal')" class="btn btn-secondary m-1">Normal</button>
              <button onclick="enviar('up')" class="btn btn-primary m-1">De Peu</button>
              <button onclick="enviar('strech')" class="btn btn-primary m-1">Estirat</button>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  const robot_id = "{{ robot_id }}";
  const telemetria = document.getElementById("telemetria");
  const socket = new WebSocket("wss://" + location.host + "/ws/telemetria/clients/" + robot_id);

  socket.onmessage = event => {
    const data = JSON.parse(event.data);
    if (data.robot_id === robot_id) {
      telemetria.textContent = JSON.stringify(data, null, 2);
    }
  };

  function enviar(moviment) {
    fetch(`/comanda/${robot_id}`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ moviment })
    });
  }
</script>
{% endblock %}
